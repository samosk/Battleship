@model Battleship.Models.BoardViewModel

@{
    ViewData["Title"] = "Game Board";
}

<div class="min-vh-100 bg-light py-5 px-3">
    <h1 class="text-center text-dark fw-light text-uppercase fs-4 mb-5" style="letter-spacing: 0.1em;">Battleship</h1>

    <div class="d-flex flex-wrap justify-content-center gap-5">
        <!-- My Fleet -->
        <div class="text-center">
            <h2 class="text-secondary text-uppercase fs-6 fw-normal mb-3" style="letter-spacing: 0.08em;">My Fleet</h2>
            <div class="bg-white border rounded-1 p-0 position-relative" style="width: 320px; height: 320px;">
                <div class="board position-relative w-100 h-100">
                    @if (Model != null)
                    {
                        @foreach (var ship in Model.MyShips)
                        {
                            var length = ship.Type switch
                            {
                                ShipType.CARRIER => 5,
                                ShipType.BATTLESHIP => 4,
                                ShipType.DESTROYER => 3,
                                ShipType.SUBMARINE => 3,
                                ShipType.PATROL_BOAT => 2,
                                _ => 0
                            };
                            var startColumn = ship.X;
                            var endColumn = ship.Orientation == ShipOrientation.HORIZONTAL ? startColumn + length : startColumn + 1;
                            var startRow = ship.Y;
                            var endRow = ship.Orientation == ShipOrientation.VERTICAL ? startRow + length : startRow + 1;
                            var bgClass = ship.IsSunk ? "bg-danger" : "bg-primary";
                            
                            <div class="@bgClass rounded-1 position-relative" style="grid-column: @(startColumn) / @(endColumn); grid-row: @(startRow) / @(endRow); margin: 2px;"></div>
                        }
                        
                        @foreach (var shot in Model.OpponentShots)
                        {
                            var shotHitsSunkShip = Model.MyShips.Where(s => s.IsSunk).Any(ship =>
                            {
                                var shipLength = ship.Type switch
                                {
                                    ShipType.CARRIER => 5,
                                    ShipType.BATTLESHIP => 4,
                                    ShipType.DESTROYER => 3,
                                    ShipType.SUBMARINE => 3,
                                    ShipType.PATROL_BOAT => 2,
                                    _ => 0
                                };
                                if (ship.Orientation == ShipOrientation.HORIZONTAL)
                                {
                                    return shot.Y == ship.Y && shot.X >= ship.X && shot.X < ship.X + shipLength;
                                }
                                else
                                {
                                    return shot.X == ship.X && shot.Y >= ship.Y && shot.Y < ship.Y + shipLength;
                                }
                            });

                            if (!shotHitsSunkShip)
                            {
                                <div class="bg-warning rounded-circle position-relative" style="grid-column: @(shot.X) / @(shot.X + 1); grid-row: @(shot.Y) / @(shot.Y + 1); width: 50%; height: 50%; margin: auto;"></div>
                            }
                        }
                    }
                </div>
            </div>
        </div>

        <!-- Enemy Fleet -->
        <div class="text-center">
            <h2 class="text-secondary text-uppercase fs-6 fw-normal mb-3" style="letter-spacing: 0.08em;">Enemy Fleet</h2>
            <div class="bg-white border rounded-1 p-0 position-relative" style="width: 320px; height: 320px;">
                <div class="board position-relative w-100 h-100">
                    @if (Model != null)
                    {
                        @foreach (var sunkShip in Model.OpponentSunkShips)
                        {
                            var length = sunkShip.Type switch
                            {
                                ShipType.CARRIER => 5,
                                ShipType.BATTLESHIP => 4,
                                ShipType.DESTROYER => 3,
                                ShipType.SUBMARINE => 3,
                                ShipType.PATROL_BOAT => 2,
                                _ => 0
                            };
                            var startColumn = sunkShip.X;
                            var endColumn = sunkShip.Orientation == ShipOrientation.HORIZONTAL ? startColumn + length : startColumn + 1;
                            var startRow = sunkShip.Y;
                            var endRow = sunkShip.Orientation == ShipOrientation.VERTICAL ? startRow + length : startRow + 1;
                            
                            <div class="bg-danger rounded-1 position-relative" style="grid-column: @(startColumn) / @(endColumn); grid-row: @(startRow) / @(endRow); margin: 2px;"></div>
                        }
                        
                        @foreach (var shot in Model.MyShots)
                        {
                            var shotHitsSunkShip = Model.OpponentSunkShips.Any(ship =>
                            {
                                var shipLength = ship.Type switch
                                {
                                    ShipType.CARRIER => 5,
                                    ShipType.BATTLESHIP => 4,
                                    ShipType.DESTROYER => 3,
                                    ShipType.SUBMARINE => 3,
                                    ShipType.PATROL_BOAT => 2,
                                    _ => 0
                                };
                                if (ship.Orientation == ShipOrientation.HORIZONTAL)
                                {
                                    return shot.Y == ship.Y && shot.X >= ship.X && shot.X < ship.X + shipLength;
                                }
                                else
                                {
                                    return shot.X == ship.X && shot.Y >= ship.Y && shot.Y < ship.Y + shipLength;
                                }
                            });

                            if (!shotHitsSunkShip)
                            {
                                <div class="bg-warning rounded-circle position-relative" style="grid-column: @(shot.X) / @(shot.X + 1); grid-row: @(shot.Y) / @(shot.Y + 1); width: 50%; height: 50%; margin: auto;"></div>
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="d-flex justify-content-center gap-4 mt-5">
        <div class="d-flex align-items-center gap-2">
            <span class="bg-primary rounded-1" style="width: 16px; height: 16px;"></span>
            <span class="text-secondary small">Ship</span>
        </div>
        <div class="d-flex align-items-center gap-2">
            <span class="bg-danger rounded-1" style="width: 16px; height: 16px;"></span>
            <span class="text-secondary small">Sunk</span>
        </div>
        <div class="d-flex align-items-center gap-2">
            <span class="bg-warning rounded-circle" style="width: 12px; height: 12px;"></span>
            <span class="text-secondary small">Shot</span>
        </div>
    </div>
</div>

<style>
    .board {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(10, 1fr);
        background-image: 
            linear-gradient(to right, #dee2e6 1px, transparent 1px),
            linear-gradient(to bottom, #dee2e6 1px, transparent 1px);
        background-size: 10% 10%;
    }
</style>